---
apiVersion: v1
kind: Namespace
metadata:
  name: postgresql
---
apiVersion: source.toolkit.fluxcd.io/v1
kind: OCIRepository
metadata:
  name: postgresql
  namespace: postgresql
spec:
  interval: 1m
  url: oci://registry-1.docker.io/bitnamicharts/postgresql
  ref:
    semver: "*"
---
apiVersion: v1
kind: Secret
metadata:
  name: test-database-postgresql
  namespace: postgresql
stringData:
  password: "sample-password"
  postgres-username: "postgres"
  postgres-password: "sample-root-password"
  replication-password: "sample-replication-password"
---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: test-database
  namespace: postgresql
spec:
  interval: 1m
  chartRef:
    kind: OCIRepository
    name: postgresql
    namespace: postgresql
  values:
    auth:
      existingSecret: test-database-postgresql
    image:
      repository: bitnamilegacy/postgresql
    postgresqlSharedPreloadLibraries: pgaudit,pg_stat_statements
