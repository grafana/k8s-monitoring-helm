# yamllint disable rule:document-start rule:line-length rule:trailing-spaces rule:empty-lines
suite: Test - Cluster Metrics - Validation
templates:
  - configmap.yaml
tests:
  - it: should fail when kube-state-metrics does not specify kube-state-metrics selectors
    set:
      testing:
        enabled: true
      kube-state-metrics:
        enabled: true
    asserts:
      - failedTemplate:
          errorMessage: |-
            The kube-state-metrics configuration requires a connection to kube-state-metrics
            Please enable the built-in deployment:
            telemetryServices:
              kube-state-metrics:
                deploy: true
            Or, set the namespace and label selectors for an existing kube-state-metrics:
            clusterMetrics:
              kube-state-metrics:
                namespace: kube-state-metrics-namespace
                labelSelectors:
                  app.kubernetes.io/name: kube-state-metrics
