---
cluster:
  name: remote-config-test

alloy-metrics:
  enabled: true
  remoteConfig:
    enabled: true
    url: https://fleet-management-prod-008.grafana.net
    auth:
      type: basic
      usernameFrom: env("GRAFANA_CLOUD_FLEET_MGMT_USER")
      passwordFrom: env("GRAFANA_CLOUD_FLEET_MGMT_TOKEN")
  alloy:
    stabilityLevel: public-preview
    extraEnv:
      - name: CLUSTER_NAME
        valueFrom:
          configMapKeyRef:
            name: test-variables
            key: CLUSTER
      - name: NAMESPACE
        valueFrom:
          fieldRef:
            fieldPath: metadata.namespace
      - name: POD_NAME
        valueFrom:
          fieldRef:
            fieldPath: metadata.name
      - name: GCLOUD_FM_COLLECTOR_ID
        value: $(CLUSTER_NAME)-$(NAMESPACE)-$(POD_NAME)
      - name: GCLOUD_RW_API_KEY
        valueFrom:
          secretKeyRef:
            name: grafana-cloud-credentials
            key: GRAFANA_CLOUD_FLEET_MGMT_TOKEN
    envFrom:
      - secretRef:
          name: grafana-cloud-credentials
      - configMapRef:
          name: test-variables
