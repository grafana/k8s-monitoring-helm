# yamllint disable rule:document-start rule:line-length rule:trailing-spaces
suite: Validations - Platforms - OpenShift
templates:
  - validations.yaml
tests:
  - it: asks you to set the platform to OpenShift
    set:
      cluster:
        name: openshift-cluster
    capabilities:
      apiVersions:
        - security.openshift.io/v1/SecurityContextConstraints
    asserts:
      - failedTemplate:
          errorMessage: |-
            This Kubernetes cluster appears to be OpenShift. Please set the platform to enable compatibility:
            global:
              platform: openshift

  - it: does not ask when the platform is set
    set:
      global:
        platform: openshift
      cluster:
        name: openshift-cluster
      alloy-metrics: {enabled: true, extraConfig: "// Enabled"}
    capabilities:
      apiVersions:
        - security.openshift.io/v1/SecurityContextConstraints
    asserts:
      - notFailedTemplate: {}
