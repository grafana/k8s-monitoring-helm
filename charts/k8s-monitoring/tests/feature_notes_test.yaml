# yamllint disable rule:document-start rule:line-length rule:trailing-spaces
suite: Feature - Notes
templates:
  - NOTES.txt
tests:
  - it: print the warning about ecosystem translation if the destinations don't match
    set:
      cluster:
        name: ci-test-cluster
      destinations:
        - name: otlp
          type: otlp
          url: http://otlp.otlp.svc:4317
          logs: {enabled: true}
      clusterEvents:
        enabled: true
      alloy-singleton:
        enabled: true
    asserts:
      - matchSnapshotRaw: {}
#
#  - it: print the warning about ServiceMonitors if they exist on the system
#    capabilities:
#      apiVersions: [monitoring.coreos.com/v1/ServiceMonitor]
#    kubernetesProvider:
#      scheme:
#        "monitoring.coreos.com/v1/ServiceMonitor":
#          gvr:
#            group: "monitoring.coreos.com"
#            version: "v1"
#            resource: "servicemonitors"
#          namespaced: true
#      objects:
#        - apiVersion: "monitoring.coreos.com/v1"
#          kind: ServiceMonitor
#          metadata:
#            name: my-kube-state-metrics-service-monitor
#            namespace: monitoring
#        - apiVersion: "monitoring.coreos.com/v1"
#          kind: ServiceMonitor
#          metadata:
#            name: prometheus-node-exporter
#            namespace: monitoring
#        - apiVersion: "monitoring.coreos.com/v1"
#          kind: ServiceMonitor
#          metadata:
#            name: redis
#            namespace: monitoring
#    set:
#      cluster:
#        name: ci-test-cluster
#      destinations:
#        - name: test
#          type: prometheus
#          url: https://prometheus.example.com
#      clusterMetrics:
#        enabled: true
#      prometheusOperatorObjects:
#        enabled: true
#      alloy-metrics:
#        enabled: true
#    asserts:
#      - matchRegexRaw:
#          pattern: ⚠️ Detected a ServiceMonitor named my-kube-state-metrics-service-monitor in namespace monitoring
#      - matchRegexRaw:
#          pattern: ⚠️ Detected a ServiceMonitor named prometheus-node-exporter in namespace monitoring
#
#  - it: can skip that validation
#    capabilities:
#      apiVersions: [monitoring.coreos.com/v1/ServiceMonitor]
#    kubernetesProvider:
#      scheme:
#        "monitoring.coreos.com/v1/ServiceMonitor":
#          gvr:
#            group: "monitoring.coreos.com"
#            version: "v1"
#            resource: "servicemonitors"
#          namespaced: true
#      objects:
#        - apiVersion: "monitoring.coreos.com/v1"
#          kind: ServiceMonitor
#          metadata:
#            name: my-kube-state-metrics-service-monitor
#            namespace: monitoring
#        - apiVersion: "monitoring.coreos.com/v1"
#          kind: ServiceMonitor
#          metadata:
#            name: prometheus-node-exporter
#            namespace: monitoring
#        - apiVersion: "monitoring.coreos.com/v1"
#          kind: ServiceMonitor
#          metadata:
#            name: redis
#            namespace: monitoring
#    set:
#      cluster:
#        name: ci-test-cluster
#      destinations:
#        - name: test
#          type: prometheus
#          url: https://prometheus.example.com
#      clusterMetrics:
#        enabled: true
#        kube-state-metrics:
#          checkForPotentialServiceMonitorConflicts: false
#        node-exporter:
#          checkForPotentialServiceMonitorConflicts: false
#      prometheusOperatorObjects:
#        enabled: true
#      alloy-metrics:
#        enabled: true
#    asserts:
#      - notMatchRegexRaw:
#          pattern: ⚠️ Detected a ServiceMonitor named my-kube-state-metrics-service-monitor in namespace monitoring
#      - notMatchRegexRaw:
#          pattern: ⚠️ Detected a ServiceMonitor named prometheus-node-exporter in namespace monitoring
