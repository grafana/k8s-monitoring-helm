---
apiVersion: v1
kind: Namespace
metadata:
  name: alloy
---
apiVersion: source.toolkit.fluxcd.io/v1
kind: HelmRepository
metadata:
  name: grafana
  namespace: alloy
spec:
  interval: 1m
  url: https://grafana.github.io/helm-charts
---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: alloy-faro-receiver
  namespace: alloy
spec:
  interval: 1m
  chart:
    spec:
      chart: alloy
      sourceRef:
        kind: HelmRepository
        name: grafana
        namespace: alloy
      interval: 1m
  values:
    controller:
      type: deployment
      replicas: 1
    alloy:
      extraPorts:
        - name: "faro"
          port: 8443
          targetPort: 8443
      stabilityLevel: "experimental"
      configMap:
        content: |-
          otelcol.receiver.faro "default" {
            endpoint = "0.0.0.0:8443"
            include_metadata = true
            output {
              logs   = [otelcol.exporter.debug.default.input]
              traces = [otelcol.exporter.debug.default.input]
             }
          }
          otelcol.exporter.debug "default" {
            verbosity = "detailed"
          }
