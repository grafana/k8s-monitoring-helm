{{ define "agent.config.logsServiceOTLP" }}
{{ with .Values.externalServices.loki }}
otelcol.receiver.loki "logs_service" {
  output {
{{- if eq .protocol "otlp" }}
    logs = [otelcol.exporter.otlp.logs_service.input]
{{- end }}
{{- if eq .protocol "otlphttp" }}
    logs = [otelcol.exporter.otlphttp.logs_service.input]
{{- end }}
  }
}

{{ if eq .authMode "basic" }}
otelcol.auth.basic "logs_service" {
  username = nonsensitive(remote.kubernetes.secret.logs_service.data[{{ .basicAuth.usernameKey | quote }}])
  password = remote.kubernetes.secret.logs_service.data[{{ .basicAuth.passwordKey | quote }}]
}
{{- end }}
{{ if eq .protocol "otlp" }}
otelcol.exporter.otlp "logs_service" {
{{- end }}
{{- if eq .protocol "otlphttp" }}
otelcol.exporter.otlphttp "logs_service" {
{{- end }}
  client {
    endpoint = nonsensitive(remote.kubernetes.secret.logs_service.data[{{ .hostKey | quote }}]) + "{{ .writeEndpoint }}"
{{ if or (.basicAuth.username) (.basicAuth.password) }}
    auth = otelcol.auth.basic.logs_service.handler
{{- end }}
{{- if .tenantId }}
    headers = { "X-Scope-OrgID" = nonsensitive(remote.kubernetes.secret.logs_service.data[{{ .tenantIdKey | quote }}]) }
{{- end }}
{{- if .tls }}
    tls {
    {{- range $k, $v := .tls }}
      {{ $k }} = {{ $v | toJson }}
    {{- end }}
    }
{{- end }}
  }
}
{{- end }}
{{ end }}
